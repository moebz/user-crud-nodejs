#!/bin/bash
# This script copies the database user_crud to user_crud_test.
# It drops user_crud_test first.
# It should be executed with "sudo".
# PGPASSWORD should contain the real database password.
# It generates a sql file (sqlfile.sql) that carries the db structure and data,
# and a log file (logfile.txt) in case its needed.
sudo systemctl restart postgresql
sudo -u postgres -i psql -c "drop database user_crud_test;"
sudo -u postgres -i psql -c "create database user_crud_test;"
PGPASSWORD="changeme" pg_dump -U postgres -h localhost user_crud > sqlfile.sql
PGPASSWORD="changeme" psql -U postgres -h localhost -d user_crud_test -f sqlfile.sql -L logfile.txt